<p id="notice"><%= notice %></p>

<h1>Tours</h1>

<% unless @tours.empty? %>

  <!-- Show the basics - not enough room to show everything here -->
  <table>
    <thead>
    <tr>
      <th>Name</th>
      <th>Itinerary</th>
      <th>Price in dollars</th>
      <th>Start date</th>
      <th>Status</th>
      <th>Num seats</th>
      <th>Agent</th>
      <th colspan="3"></th>
    </tr>
    </thead>

    <tbody>
    <% @tours.each do |tour| %>
      <tr>
        <td><%= tour.name %></td>
        <td><%= tour.itinerary %></td>
        <td><%= tour.price_in_dollars %></td>
        <td><%= tour.start_date %></td>
        <td><%= tour.status_description %></td>
        <td><%= tour.num_seats %></td>
        <td><%= Listing.get_agent_name_for_tour(tour) %></td>
        <td><%= link_to 'Show', tour %></td>
        <td>
          <% if current_user_can_modify_given_tour?(tour) %>
            <%= link_to 'Edit', edit_tour_path(tour) %>
          <% end %>
        </td>
        <td>
          <% if current_user_can_modify_given_tour?(tour) %>
            <%= link_to 'Destroy', tour, method: :delete, data: { confirm: 'Are you sure?' } %>
          <% end %>
        </td>
      </tr>
    <% end %>
    </tbody>
  </table>

<% end %>

<% if @tours.empty? %>
  No Results
<% end %>

<!-- Provide search filters -->
<h2>Filter Results</h2>

<!-- Make sure to submit the form "local" so that it actually returns the updated HTML -->
<!-- https://guides.rubyonrails.org/form_helpers.html -->
<!-- https://m.patrikonrails.com/rails-5-1s-form-with-vs-old-form-helpers-3a5f72a8c78a -->
<!-- https://www.engineyard.com/blog/using_form_with-vs-form_for-vs-form_tag -->
<%= form_with model: @tour, local: true, method: "get" do |form| %>

  <!-- Select tour names including given string -->
  <%= form.label "Tour Name Includes" %>
  <%= form.text_field :tour_name, value: user_selected_tour_name %>

  <!-- Drop down for selecting location: https://guides.rubyonrails.org/form_helpers.html -->
  <%= form.label "Desired Location" %>
  <%= form.select(:desired_location) do %>
    <!-- The first option has a special value so that we can see if there is no desired location -->
    <%= content_tag(:option, "", value: -1) %>
    <% Location.all.each do |loc| -%>
      <%= content_tag(
              :option,
              loc.user_friendly_description,
              value: loc.id,
              selected: user_selected_location?(loc)
          ) %>
    <% end %>
  <% end %>

  <!-- Select maximum price -->
  <%= form.label "Max Price ($)" %>
  <%= form.number_field number_with_precision(:max_price_dollars, precision: 2),
                        step: 0.01,
                        value: user_selected_maximum_price
  %>

  <!-- Submit search filters -->
  <div class="actions">
    <%= form.submit "Search" %>
  </div>

<%end %>

<% if current_user_can_create_tour? %>
  <br>
  <%= link_to 'New Tour', new_tour_path %>
<% end %>
