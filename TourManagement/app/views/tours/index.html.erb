<p id="notice"><%= notice %></p>

<h1>Tours</h1>

<!-- Provide search filters -->
<!-- https://guides.rubyonrails.org/form_helpers.html -->
<!-- https://m.patrikonrails.com/rails-5-1s-form-with-vs-old-form-helpers-3a5f72a8c78a -->
<%= form_with model: @tour, method: "get" do |form| %>
  <!-- Drop down for selecting location: https://guides.rubyonrails.org/form_helpers.html -->
  <%= form.label "Desired Location" %>
  <%= form.select("desired_location") do %>
    <!-- The first option has a special value so that we can see if there is no desired location -->
    <%= content_tag(:option, "", value: -1) %>
    <% Location.all.each do |loc| -%>
      <%= content_tag(
        :option,
        loc.user_friendly_description,
        value: loc.id
      ) %>
    <% end %>
  <% end %>
  <div class="actions">
    <%= form.submit "Search" %>
  </div>
<%end %>

<!-- Show the basics - not enough room to show everything here -->
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Price in cents</th>
      <th>Start date</th>
      <th>Status</th>
      <th>Num seats</th>
      <th>Agent</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @tours.each do |tour| %>
      <tr>
        <td><%= tour.name %></td>
        <td><%= tour.price_in_cents %></td>
        <td><%= tour.start_date %></td>
        <td><%= tour.status_description %></td>
        <td><%= tour.num_seats %></td>
        <td><%= Listing.get_agent_name_for_tour(tour) %></td>
        <td><%= link_to 'Show', tour %></td>
        <td>
          <% if current_user_can_modify_given_tour?(tour) %>
            <%= link_to 'Edit', edit_tour_path(tour) %>
          <% end %>
        </td>
        <td>
          <% if current_user_can_modify_given_tour?(tour) %>
            <%= link_to 'Destroy', tour, method: :delete, data: { confirm: 'Are you sure?' } %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<% if current_user_can_create_tour? %>
  <%= link_to 'New Tour', new_tour_path %>
<% end %>
